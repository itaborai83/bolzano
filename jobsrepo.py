import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import scipy.stats as stats
import scipy.special as special
from scipy.stats.mstats import gmean, hmean
import math
import util
import kneebow.rotor as kbr

MIN_JOB_DURATION        = 60 
WINDOW_SIZE_FACTOR      = 0.2
WINDOW_SIZE_MIN         = 12
ELBOW_FINDING_EXIT_QTY  = 100
GRAPH_ASPECT            = 0.2
GRAPH_CM2INCH           = 0.393701
GRAPH_WIDTH             = 30.0 * GRAPH_CM2INCH
GRAPH_HEIGHT            = 10.0 * GRAPH_CM2INCH
LOG2                    = math.log(2.0)

FETCH_SQL = """
    SELECT  (START_DATE || ' ' || START_TIME)::TIMESTAMP AS START
    ,       DURATION
    FROM    SAP_JOBS
    WHERE   NAME        =  ?
    AND     START_DATE  >= ?
    AND     END_DATE    <= ?
    AND     DURATION    >= ?
    AND     STATUS      = 'F'
    ORDER   BY START_DATE
    ,       START_TIME
"""

FETCH_SQL_LIKE = """
    SELECT  (START_DATE || ' ' || START_TIME)::TIMESTAMP AS START
    ,       DURATION
    FROM    SAP_JOBS
    WHERE   NAME        LIKE ?
    AND     START_DATE  >= ?
    AND     END_DATE    <= ?
    AND     DURATION    >= ?
    AND     STATUS      = 'F'
    ORDER   BY START_DATE
    ,       START_TIME
"""

JOBS = [ 'PB_SD0131N05A', 'PB_MM2195N05A', 'PB_CCM0002N05A', 'PB_FI2136N10A', 'PB_CCM0001N05A', 'PB_HRT007N1501A', 'PB_HR0088N35A', 'PB_HR2369N05A', 'PB_FIA002N05A', 'PB_SD2058N05A', 'PB_MM2091N05A', 'PB_MM2323N20A', 'PB_FI0050N19A', 'PB_HR2037N01A', 'PB_HRT004N1501IA', 'PB_FI2271N60A', 'PB_HRT004N1501EA', 'PB_HRT004N1501SA', 'PB_FI2071N05A', 'PB_FI0050N08A', 'PB_HRT004N1501MA', 'PB_HRT004N1501JA', 'PB_HRT004N1501QA', 'PB_FIT007N05A', 'PB_HRT004N1501RA', 'PB_HRT004N1501BA', 'PB_HRT004N1501PA', 'PB_HRT004N1501NA', 'PB_FI0050N29A', 'PB_HRT004N1501OA', 'PB_HRT004N1501LA', 'PB_HRT004N1501CA', 'PB_HRT004N1501KA', 'PB_HRT004N1501DA', 'PB_HR2312N48A', 'PB_HRT004N1501AA', 'PB_HRT004N1501GA', 'PB_HRT004N1501TA', 'PB_FI1049N33A', 'PB_HRT004N1501FA', 'PB_HR0138N05A', 'PB_HR2373N05A', 'PB_HRT004N1501HA', 'PB_HR0139N05A', 'PB_MM2323N15A', 'PB_MM0019N05A', 'PB_HR2247N70A', 'PB_FIT105N06A', 'PB_HR2012N03A', 'PB_HRT004N0501JA', 'PB_FIT201N75A', 'PB_HR2312N46A', 'PB_PS0063N05A', 'PB_MM0019N10A', 'PB_FI1049N38A', 'PB_HRT012N0501IA', 'PB_HRT004N0501KA', 'PB_HRT004N0501RA', 'PB_HRT012N0501JA', 'PB_HR0133N05A', 'PB_HRT004N0501IA', 'PB_HRT004N0501MA', 'PB_HRT004N0501PA', 'PB_FI2159N05A', 'PB_HRT004N0501NA', 'PB_HRT004N0501LA', 'PB_FIT201N32A', 'PB_HRT004N0501OA', 'PB_HRT004N0501DA', 'PB_FI0020N05A', 'PB_CO2116N05A', 'PB_HRT004N0501FA', 'PB_HRT004N0501EA', 'PB_HRT012N0501KA', 'PB_HRT004N0501CA', 'PB_HR0206N42A', 'PB_HR0206N26A', 'PB_HRT004N3101LA', 'PB_FI1049N20A', 'PB_HRT004N0501QA', 'PB_HR0206N24A', 'PB_HRT004N0501GA', 'PB_HRT004N0501SA', 'PB_HR2335N05A', 'PB_HR2301N10A', 'PB_MM1157N05A', 'PB_HRT004N0501HA', 'PB_PS1031N15A', 'PB_HRT004N3101BA', 'PB_HRT004N3101NA', 'PB_PS1031N10A', 'PB_HRT004N0501TA', 'PB_HRT004N3101MA', 'PB_CO2117N05A', 'PB_HRT004N3101AA', 'PB_HRT011N6501A', 'PB_HRT004N3101CA', 'PB_FI1049N92A', 'PB_HRT004N3101EA', 'PB_HRT012N0501OA', 'PB_HRT004N0501BA', 'PB_HRT004N3101PA', 'PB_HRT004N3101OA', 'PB_CO2115N11A', 'PB_CO1099N390A', 'PB_HRT004N0501AA', 'PB_HRT004N3101QA', 'PB_HRT004N2501CA', 'PB_HR0085N0501A', 'PB_CO2116N40A', 'PB_AM2041N05A', 'PB_HRT004N3101RA', 'PB_HRT004N3101JA', 'PB_HRT011N7001A', 'PB_HRT004N3101IA', 'PB_FI0050N02A', 'PB_HR0184N05A', 'PB_HRT004N3101SA', 'PB_HRT002N0501A', 'PB_FIA008N05A', 'PB_FIA002N10A', 'PB_HRT010N85A', 'PB_HRT004N2501EA', 'PB_HRT004N2501LA', 'PB_HRT004N3101DA', 'PB_HRT004N2501BA', 'PB_HRT004N2501DA', 'PB_HR0206N40A', 'PB_HRT004N2501KA', 'PB_HRT012N0501CA', 'PB_HRT004N2501JA', 'PB_HRT004N2501NA', 'PB_HR0136N05A', 'PB_HRT004N2501MA', 'PB_HRT012N0501RA', 'PB_FI1049N27A', 'PB_CO2116N30A', 'PB_FIT105N10A', 'PB_FI1049N69A', 'PB_CO1050N02A', 'PB_CO2115N50A', 'PB_FI5054N05A', 'PB_HRT004N2501OA', 'PB_HRT004N3101TA', 'PB_CO2115N55A', 'PB_HRT004N3101KA', 'PB_PS0001N05A', 'PB_FI2000N20A', 'PB_HR2191N08A', 'PB_IS0262N05A', 'PB_HRT011N4501A', 'PB_HR0056N45A', 'PB_IS0168N15A', 'PB_HRT004N2501PA', 'PB_HR0206N44A', 'PB_HR1017N05A', 'PB_HRT011N2501A', 'PB_HRT004N3101FA', 'PB_HR0208N05A', 'PB_HR0206N28A', 'PB_HRT004N3101GA', 'PB_MM2108N60A', 'PB_HRT004N2501QA', 'PB_CO2115N12A', 'PB_FI1049N167A', 'PB_HR2301N25A', 'PB_MM2108N75A', 'PB_HR0206N38A', 'PB_HRT012N0501PA', 'PB_CO2116N15A', 'PB_MM2108N80A', 'PB_FI1049N550A', 'PB_CO1051N04A', 'PB_HRT004N2501SA', 'PB_FI0050N01A', 'PB_FI2297N05A', 'PB_HRT004N2501RA', 'PB_HRT011N5001A', 'PB_HR0181N05A', 'PB_HRT012N0501TA', 'PB_HRT012N0501SA', 'PB_FI2271N40A', 'PB_FI0050N13A', 'PB_HR0021N15A', 'PB_FIT201N31A', 'PB_HR0137N05A', 'PB_HR0206N34A', 'PB_HR0179N05A', 'PB_CO1050N13A', 'PB_FI2136N05A', 'PB_CO2115N10A', 'PB_HR0180N05A', 'PB_HRT011N3001A', 'PB_HR0178N05A', 'PB_HR0140N05A', 'PB_CO1050N15A', 'PB_CO1050N12A', 'PB_FI1049N12A', 'PB_CO1050N14A', 'PB_CO2115N07A', 'PB_HRT004N3101HA', 'PB_CO1050N10A', 'PB_CO2115N05A', 'PB_FI0190N08A', 'PB_HR0182N05A', 'PB_HRT012N0501LA', 'PB_HRT012N0501EA', 'PB_HRT011N8001A', 'PB_HRT004N2501AA', 'PB_HRT004N2501TA', 'PB_FI2271N45A', 'PB_HRT012N0501NA', 'PB_HRT012N0501AA', 'PB_PS1031N05A', 'PB_HR0187N05A', 'PB_HRT016N53A', 'PB_HR0196N05A', 'PB_HRT012N0501MA', 'PB_HR2247N12A', 'PB_HR2312N44A', 'PB_HR0186N05A', 'PB_CO1001N15A', 'PB_HR2312N52A', 'PB_HR0056N05A', 'PB_FI2271N50A', 'PB_CO2115N16A', 'PB_HR2307N05A', 'PB_HR0056N25A', 'PB_FI2271N55A', 'PB_HRT004N2501FA', 'PB_HR1028N05A', 'PB_FI2175N05A', 'PB_HRT012N0501QA', 'PB_HR1028N40A', 'PB_HRT007N0501A', 'PB_CO2115N06A', 'PB_HRT004N1601JA', 'PB_MM2321N40A', 'PB_HR0183N05A', 'PB_FI2139N02A', 'PB_HRT012N0501DA', 'PB_HRT008N0601CA', 'PB_HR2311N44A', 'PB_HRT004N2501GA', 'PB_FI2271N20A', 'PB_HRT004N1601IA', 'PB_CO2115N17A', 'PB_FI2271N10A', 'PB_26-0379N65A', 'PB_HR0195N05A', 'PB_HR2247N22A', 'PB_HRT003N2001A', 'PB_HRT012N0501FA', 'PB_HR1034N05A', 'PB_CO1099N395A', 'PB_CO2115N25A', 'PB_HRT004N1601NA', 'PB_HR1014N05A', 'PB_HR0203N05A', 'PB_FI2233N15A', 'PB_HR0185N05A', 'PB_CO1049N43A', 'PB_HRT008N0601AA', 'PB_CO2154N05A', 'PB_AI0001N109A', 'PB_HRT008N0601DA', 'PB_HR2247N18A', 'PB_MM2321N45A', 'PB_HRT004N1601RA', 'PB_HR2247N24A', 'PB_FIT105N03A', 'PB_HRT012N0501BA', 'PB_CO2115N30A', 'PB_MM2108N65A', 'PB_FI2000N22A', 'PB_HRT011N1501IA', 'PB_HRT012N0501GA', 'PB_HR0057N1001A', 'PB_MM2081N05A', 'PB_HRT011N1501DA', 'PB_FI0044N45A', 'PB_CO1050N04A', 'PB_HRT004N2501HA', 'PB_HR1041N0201A', 'PB_HR0206N36A', 'PB_HR0056N30A', 'PB_HRT011N5501TA', 'PB_HR2247N16A', 'PB_CO2157N11A', 'PB_HRT012N0501HA', 'PB_HR2247N20A', 'PB_HRT011N1501EA', 'PB_HR2247N26A', 'PB_HRT011N1501GA', 'PB_CO1099N392A', 'PB_HRT004N1601PA', 'PB_AI0001N111A', 'PB_CO2116N20A', 'PB_HRT004N1601CA', 'PB_CO2115N35A', 'PB_HR1042N15A', 'PB_HRT004N1601MA', 'PB_HRT011N1501MA', 'PB_CO2116N25A', 'PB_HRT004N3001IA', 'PB_HR0058N0501A', 'PB_FI2271N25A', 'PB_HR2247N10A', 'PB_CO2157N22A', 'PB_HR2312N54A', 'PB_HRT011N1501SA', 'PB_AI0001N105A', 'PB_HRT004N1601LA', 'PB_HRT004N3001RA', 'PB_HRT011N5501IA', 'PB_FI0044N08A', 'PB_HRT004N3001GA', 'PB_HRT004N1601EA', 'PB_HRT004N3001LA', 'PB_HRT011N1501LA', 'PB_HR0113N10A', 'PB_HRT004N3001NA', 'PB_HRT004N3001BA', 'PB_HR1029N05A', 'PB_HRT011N1501HA', 'PB_HRT011N1501OA', 'PB_HRT004N1601OA', 'PB_HRT011N1501CA', 'PB_HRT011N1501RA', 'PB_HRT011N1501NA', 'PB_HRT008N0601BA', 'PB_CO1001N05A', 'PB_HR2008N0501A', 'PB_CO1084N10A', 'PB_CO2116N10A', 'PB_HR2280N05A', 'PB_HRT011N5501RA', 'PB_HR0206N30A', 'PB_HRT004N3001FA', 'PB_HRT011N5501OA', 'PB_HRT004N3001SA', 'PB_HRT003N15A', 'PB_HRT011N5501SA', 'PB_HR1042N05A', 'PB_HRT004N3001HA', 'PB_HRT004N1601HA', 'PB_HRT011N5501JA', 'PB_HRT011N5501PA', 'PB_HRT004N1601KA', 'PB_HRT011N5501GA', 'PB_AI0001N86A', 'PB_FI0044N50A', 'PB_HRT004N1601FA', 'PB_HRT004N1601BA', 'PB_HRT004N1601TA', 'PB_HRT011N1501FA', 'PB_HRT004N3001QA', 'PB_CO2157N16A', 'PB_HRT004N1601GA', 'PB_CO2115N15A', 'PB_HRT011N1501JA', 'PB_HRT004N1601DA', 'PB_MM2321N50A', 'PB_CO1051N13A', 'PB_HRT011N1501TA', 'PB_HRT011N5501HA', 'PB_HR2011N03A', 'PB_HRT004N3001TA', 'PB_FI1149N05A', 'PB_HRT011N5501MA', 'PB_HRT011N5501QA', 'PB_HRT011N5501EA', 'PB_HRT004N3001OA', 'PB_HRT004N1601QA', 'PB_HRT004N3001CA', 'PB_HR2247N14A', 'PB_HR1041N0501A', 'PB_HRT004N1601SA', 'PB_HRT011N5501AA', 'PB_FIT201N39A', 'PB_HRT011N1501KA', 'PB_HRT004N3001EA', 'PB_FI0044N09A', 'PB_AI0001N97A', 'PB_FI1049N60A', 'PB_BC2021N10A', 'PB_FI2095N01A', 'PB_HRT011N1501QA', 'PB_HRT004N3001AA', 'PB_CO2116N35A', 'PB_FI1049N40A', 'PB_MM0244N10A', 'PB_HRT011N5501FA', 'PB_HRT011N5501NA', 'PB_HR0088N30A', 'PB_HRT011N5501CA', 'PB_HRT011N1501BA', 'PB_PO0003N10A', 'PB_HRT004N3001PA', 'PB_HR0135N15601A', 'PB_FI1049N44A', 'PB_HR1041N1501A', 'PB_HRT004N1601AA', 'PB_FI2271N15A', 'PB_HRT011N5501LA', 'PB_PS2054N25A', 'PB_HR0135N12501A', 'PB_HR2285N05A', 'PB_FI0044N47A', 'PB_CO1051N10A', 'PB_HRT011N1501PA', 'PB_HRT004N3001JA', 'PB_HRT011N5501KA', 'PB_HRT011N1501AA', 'PB_HRT011N5501BA', 'PB_FI2073N05A', 'PB_FI1049N18A', 'PB_FI0050N27A', 'PB_AI0001N09A', 'PB_CO2157N20A', 'PB_HRT002N0501AA', 'PB_HRT008N0501CA', 'PB_HR1041N1001A', 'PB_HR0103N2501A', 'PB_HR0135N10001A', 'PB_HR0135N14001A', 'PB_MM2224N05A', 'PB_CO2157N15A', 'PB_FI0050N26A', 'PB_HRT004N3001DA', 'PB_CO2157N50A', 'PB_HRT011N5501DA', 'PB_HR0050N0701A', 'PB_HRT004N3001MA', 'PB_CO2157N10A', 'PB_FI0262N98A', 'PB_CO2157N55A', 'PB_AI0001N98A', 'PB_HRT008N0501DA', 'PB_FI2271N05A', 'PB_CO1099N33A', 'PB_HR2301N55A', 'PB_CO2157N21A', 'PB_CO2115N45A', 'PB_CO1099N388A', 'PB_FI1049N04A', 'PB_HR0085N1501A', 'PB_HR2247N23A', 'PB_FI0262N110A', 'PB_CO2115N22A', 'PB_CO2157N17A', 'PB_CO2115N21A', 'PB_HR0135N11001A', 'PB_HR1011N05A', 'PB_HR0135N15501A', 'PB_HRT004N3001KA', 'PB_HR0050N1001A', 'PB_HR0206N32A', 'PB_HR0135N8001A', 'PB_FI1049N320A', 'PB_FI2271N30A', 'PB_CO2157N26A', 'PB_HR0103N4501A', 'PB_HR0081N05A', 'PB_BC0002N49A', 'PB_HR2247N21A', 'PB_CO1049N120A', 'PB_HRT004N1001JA', 'PB_CO2157N25A', 'PB_CO2118N05A', 'PB_CO1099N32A', 'PB_HR2270N30A', 'PB_FIT201N33A', 'PB_HR1005N01A', 'PB_FI2042N15A', 'PB_CO1099N394A', 'PB_HR0056N35A', 'PB_CO2157N45A', 'PB_HRT011N1001AA', 'PB_HRT008N0501AA', 'PB_HRT004N2001GA', 'PB_CO2157N40A', 'PB_HRT004N2001FA', 'PB_IS2077N05A', 'PB_CO2115N40A', 'PB_HR0135N2001A', 'PB_HR0057N0501A', 'PB_HR0056N15A', 'PB_HR0075N20A', 'PB_HR2247N11A', 'PB_HR0135N5001A', 'PB_CO1084N05A', 'PB_CO2157N12A', 'PB_PM2131N25A', 'PB_CO2157N35A', 'PB_HR0085N0501DA', 'PB_CO1050N08A', 'PB_HR0135N11501A', 'PB_HRT004N1001DA', 'PB_HRT002N0501CA', 'PB_MM2321N35A', 'PB_FI1144N05A', 'PB_FI2271N35A', 'PB_FIT201N35A', 'PB_HR2247N25A', 'PB_MM2321N30A', 'PB_FIT105N15A', 'PB_FI1049N35A', 'PB_HRT008N0501BA', 'PB_CO0127N05A', 'PB_HRT004N2001PA', 'PB_MM2321N55A', 'PB_FI1049N46A', 'PB_FI1049N42A', 'PB_SD0632N05A', 'PB_HR0103N0501A', 'PB_CO1099N568A', 'PB_HRT004N2001JA', 'PB_TV0171N05A', 'PB_CO1099N468A', 'PB_HR0135N12001A', 'PB_BC0002N81A', 'PB_HRT004N2001OA', 'PB_FI0262N181A', 'PB_HRT007N1001GA', 'PB_HRT002N0501BA', 'PB_HRT004N2001EA', 'PB_HRT004N1001IA', 'PB_HRT004N1001MA', 'PB_FI1049N05A', 'PB_PS1015N05A', 'PB_IS1019N10A', 'PB_HR0085N0501CA', 'PB_HRT007N1001FA', 'PB_HRT004N1001LA', 'PB_HRT004N2001LA', 'PB_FI2233N10A', 'PB_HR1028N15A', 'PB_FI2068N05A', 'PB_CO1099N433A', 'PB_HRT004N2001IA', 'PB_HR0085N0501BA', 'PB_HRT004N2001CA', 'PB_HRT004N1001OA', 'PB_HRT004N2001NA', 'PB_FI0262N22A', 'PB_HRT004N1001NA', 'PB_HRT004N2001MA', 'PB_HRT004N2001BA', 'PB_CO1099N269A', 'PB_FI0262N125A', 'PB_IS2041N15A', 'PB_HR0016N05A', 'PB_CO1099N407A', 'PB_HR2247N27A', 'PB_HRT007N1001TA', 'PB_CO0124N05A', 'PB_HRT004N1001EA', 'PB_MM2321N25A', 'PB_HRT004N2001QA', 'PB_CO1051N06A', 'PB_HRT004N1001PA', 'PB_MMT001N55A', 'PB_HRT002N0501DA', 'PB_FI2068N10A', 'PB_MM2321N10A', 'PB_HRT004N1001BA', 'PB_HR0056N50A', 'PB_MM2321N05A', 'PB_HRT004N2001AA', 'PB_HR2247N19A', 'PB_HRT004N2001RA', 'PB_CO1062N12A', 'PB_HRT004N2001TA', 'PB_HR2247N13A', 'PB_MM0144N20A', 'PB_HRT004N1001CA', 'PB_HRT004N1001RA', 'PB_HR0107N10A', 'PB_FI0190N25A', 'PB_HRT004N1001KA', 'PB_HRT004N2001SA', 'PB_HRT011N1001CA', 'PB_HRT004N2001DA', 'PB_CO1099N366A', 'PB_HRT004N1001QA', 'PB_FIA001N05A', 'PB_HRT004N2001KA', 'PB_HRT004N1001SA', 'PB_CO2115N26A', 'PB_HRT004N1001AA', 'PB_HRT004N2001HA', 'PB_PM2131N15A', 'PB_SD2134N10A', 'PB_HRT004N1001FA', 'PB_HRT004N1001GA', 'PB_HR0085N0501AA', 'PB_HRT004N1001HA', 'PB_CO1099N418A', 'PB_HR2312N42A', 'PB_HRT004N1001TA', 'PB_26-0379N75A', 'PB_PO0014N05A', 'PB_26-0379N63A', 'PB_26-0379N70A', 'PB_FIT201N50A', 'PB_26-0379N67A', 'PB_HR2311N40A', 'PB_FIT105N20A', 'PB_HR2319N05A', 'PB_CO1099N267A', 'PB_FI1028N05A', 'PB_FI2169N10A', 'PB_FI0190N05A', 'PB_CO2147N20A', 'PB_HR2319N10A', 'PB_HRT007N1001SA', 'PB_HRT011N1001BA', 'PB_FIT105N04A', 'PB_CO2115N20A', 'PB_CO1062N36A', 'PB_HRT007N1001JA', 'PB_FI1049N28A', 'PB_FI0262N104A', 'PB_CCM0001N25A', 'PB_CO1099N417A', 'PB_MM2232N15A', 'PB_FI2332N05A', 'PB_FI2146N05A', 'PB_MMT001N05A', 'PB_CO1049N230A', 'PB_CO2147N25A', 'PB_HR0088N15A', 'PB_MM0127N05A', 'PB_HR2319N09A', 'PB_FI1009N05A', 'PB_HRT007N1001PA', 'PB_CO1099N603A', 'PB_HR2301N05A', 'PB_HR2270N20A', 'PB_HR2312N40A', 'PB_HR2191N02A', 'PB_FIT201N41A', 'PB_HR1028N25A', 'PB_PS2054N15A', 'PB_HR2311N42A', 'PB_HR2301N68A', 'PB_CO2016N25A', 'PB_HR2319N07A', 'PB_HRT007N1001IA', 'PB_AI0001N87A', 'PB_FI0483N05A', 'PB_HRT011N1001DA', 'PB_HRT007N1001HA', 'PB_HR2319N06A', 'PB_CO1049N229A', 'PB_CO1099N219A', 'PB_HR2247N17A', 'PB_HRT007N1001EA', 'PB_HR2247N15A', 'PB_CO1062N10A', 'PB_HRT007N1001CA', 'PB_HR2191N06A', 'PB_FI2217N05A', 'PB_CO1099N330A', 'PB_HRT007N1001BA', 'PB_AI0001N146A', 'PB_TRT002N45A', 'PB_HRT007N1001MA', 'PB_AI0001N55A', 'PB_AI0001N24A', 'PB_AI0001N54A', 'PB_MM2108N20A', 'PB_AI0001N22A', 'PB_HRT007N1001QA', 'PB_AI0001N173A', 'PB_CO1099N293A', 'PB_AI0001N53A', 'PB_HR2312N41A', 'PB_FI1049N29A', 'PB_HRT007N1001NA', 'PB_AI0001N117A', 'PB_CO2013N05A', 'PB_FI2332N25A', 'PB_HRT007N1001OA', 'PB_CO1051N02A', 'PB_HRT007N1001AA', 'PB_HR2301N76A', 'PB_HR2270N25A', 'PB_FI0044N14A', 'PB_MM2086N07A', 'PB_FIT201N40A', 'PB_HR2270N15A', 'PB_HRT007N1001LA', 'PB_FIT201N37A', 'PB_FI0262N95A', 'PB_HR2301N64A', 'PB_FI0044N15A', 'PB_TRT004N22A', 'PB_HRT007N1001RA', 'PB_CO1099N63A', 'PB_HR0206N04A', 'PB_HR2319N08A', 'PB_HR2270N10A', 'PB_HR2270N05A', 'PB_FI0044N23A', 'PB_CO1099N431A', 'PB_HRT004N15M0A', 'PB_HR0206N12A', 'PB_CO1099N434A', 'PB_CO1099N186A', 'PB_FI0050N70A', 'PB_TV0182N10A', 'PB_HR2319N03A', 'PB_CO1099N324A', 'PB_HR2175N10A', 'PB_CO1099N328A', 'PB_CO1099N134A', 'PB_HR2301N60A', 'PB_HR0206N02A', 'PB_FI0044N74A', 'PB_CO1099N182A', 'PB_CO1099N403A', 'PB_HR2301N80A', 'PB_MM2086N08A', 'PB_CO1099N111A', 'PB_CO1049N127A', 'PB_CO1099N57A', 'PB_CO1049N216A', 'PB_FI1049N22A', 'PB_HR2301N74A', 'PB_HRT012N05M0A', 'PB_CO1099N61A', 'PB_PS2054N20A', 'PB_CO1099N180A', 'PB_HR2301N70A', 'PB_PS2054N10A', 'PB_IS1012N05A', 'PB_FI0465N10A', 'PB_HR2301N72A', 'PB_FI0044N44A', 'PB_HR2319N04A', 'PB_CO1049N269A', 'PB_CO1099N192A', 'PB_HRT007N1001KA', 'PB_HRT010N10A', 'PB_HR0206N20A', 'PB_HR2368N05A', 'PB_CO2016N05A', 'PB_HR2301N62A', 'PB_FIT201N71A', 'PB_HRT007N1001DA', 'PB_CO1099N605A', 'SUB_TP_TRT006N05A', 'SUB_RO_TRT006N05A', 'PB_HRT008N03A', 'SUB_PN_TRT006N05A', 'SUB_AD_TRT006N05A', 'PB_FI0190N20A', 'PB_TRT002N44A', 'PB_CO1099N391A', 'SUB_GU_TRT006N05A', 'SUB_PG_TRT006N05A', 'SUB_RE_MM0271N05A', 'PB_TRT006N05A', 'PB_HR2301N78A', 'PB_PO2031N05A', 'PB_HR2301N84A', 'PB_HR2191N04A', 'PB_HRT008N01A', 'PB_HR2301N96A', 'PB_FI0044N73A', 'PB_CO1050N01A', 'PB_HR0206N18A', 'SUB_TP_TRT006N07A', 'SUB_RO_TRT006N07A', 'PB_HR2301N94A', 'PB_FIT201N66A', 'PB_HR0206N22A', 'SUB_AD_TRT006N07A', 'SUB_GU_TRT006N07A', 'PB_FI0512N15A', 'PB_HRT011N0501EA', 'PB_HR2301N98A', 'SUB_PG_TRT006N07A', 'PB_HR2301N92A', 'PB_MM1104N05A', 'PB_HR2301N82A', 'SUB_PN_TRT006N07A', 'PB_CO1062N35A', 'PB_HR2301N90A', 'PB_HR1038N05A', 'PB_CO1062N22A', 'PB_CO1099N368A', 'PB_FI0044N72A', 'PB_HR0206N16A', 'PB_CO1099N105A', 'PB_HR2301N86A', 'PB_HR2301N66A', 'PB_FI0044N71A', 'PB_CO1099N274A', 'PB_HR2301N88A', 'PB_CO1049N205A', 'PB_FI0044N70A', 'PB_CO1099N325A', 'PB_TRT006N07A', 'PB_AI0001N129A', 'PB_FI0262N17A', 'PB_AI0001N133A', 'PB_CO1099N199A', 'PB_CO1099N183A', 'PB_AI0001N104A', 'PB_CO1049N59A', 'PB_26-0379N69A', 'PB_CO1099N336A', 'PB_CO1051N12A', 'PB_HR0300N05A', 'PB_MM2172N05A', 'PB_CO1099N04A', 'PB_FI2152N05A', 'PB_HR2284N05A', 'PB_PST001N44A', 'PB_HRT011N0501AA', 'PB_MM2108N70A', 'PB_CO1099N222A', 'PB_FIT105N05A', 'PB_HRT011N0501CA', 'PB_FI0262N15A', 'PB_CO1099N223A', 'PB_MM2108N05A', 'PB_FI2144N05A', 'PB_CO2113N11A', 'PB_HR0206N06A', 'PB_FI1049N31A', 'PB_HRT004N05M0A', 'PB_MM2232N05A', 'PB_CO1049N272A', 'PB_HR2311N30A', 'PB_FIT201N36A', 'PB_CO1049N286A', 'PB_CO1099N342A', 'PB_HRT011N0501IA', 'PB_CO1099N224A', 'PB_CO1099N05A', 'PB_FIT201N42A', 'PB_CO1099N184A', 'PB_HRT011N15M0A', 'PB_TV0436N05A', 'PB_HRT017N05A', 'PB_CO1099N398A', 'PB_HRT011N0501KA', 'PB_AI0001N102A', 'PB_CO1099N121A', 'PB_CO1062N08A', 'PB_CO0124N10A', 'PB_CO1099N225A', 'PB_HR0206N14A', 'PB_CO1099N215A', 'PB_CO1099N353A', 'PB_TRT004N30A', 'PB_AI0001N103A', 'PB_FI0262N21A', 'PB_CO2147N05A', 'PB_CO1049N218A', 'PB_HRT010N05A', 'PB_IS0168N05A', 'PB_HR0114N05A', 'PB_CO1049N189A', 'PB_PST001N20A', 'PB_HR2319N02A', 'PB_CO2113N12A', 'PB_AI0001N99A', 'PB_HR0134N05A', 'PB_TRT005N45A', 'PB_HRT011N0501JA', 'PB_QMT002N05A', 'PB_CO1099N393A', 'PB_CO1099N435A', 'PB_TRT002N47A', 'PB_CO1049N279A', 'PB_HR2177N05A', 'PB_FI0262N20A', 'PB_FI0044N36A', 'PB_FI2258N05A', 'PB_HR0630N25A', 'PB_BC0002N29A', 'PB_FI0541N10A', 'PB_CO1099N06A', 'PB_FI2063N05A', 'PB_TRT002N48A', 'PB_CO1099N402A', 'PB_CO1099N216A', 'PB_FI0580N05A', 'PB_HRT011N0501BA', 'PB_CO1099N369A', 'PB_HR0206N08A', 'PB_TRT006N03A', 'PB_MM1133N10A', 'PB_MM2326N05A', 'PB_MM2288N20A', 'PB_CO1099N190A', 'PB_CO2082N10A', 'PB_PST001N42A', 'PB_HRT011N0501DA', 'PB_FI0044N16A', 'PB_CO1049N259A', 'PB_FI0044N20A', 'PB_HRT007N1101A', 'PB_PS0091N05A', 'PB_CO1099N234A', 'PB_CO1099N326A', 'PB_CO1049N288A', 'PB_CO1099N291A', 'PB_FI2256N05A', 'PB_FIT201N65A', 'PB_CO1099N01A', 'PB_FI1049N16A', 'PB_CO1049N281A', 'PB_HRT011N0501QA', 'PB_BC0002N11A', 'PB_HRT011N0501NA', 'PB_HR2129N05A', 'PB_HR2301N15A', 'PB_CO1062N02A', 'PB_CO1049N62A', 'PB_HR2330N05A', 'PB_CO1099N226A', 'PB_HRT011N0501LA', 'PB_EB0006N05A', 'PB_CO2110N01A', 'PB_SD0580N40A', 'PB_HR0206N10A', 'PB_HRT011N0501SA', 'PB_HR0114N10A', 'PB_HR2343N05A', 'PB_HRT011N0501MA', 'PB_CO1001N10A', 'PB_HRT011N0501PA', 'PB_CO1062N45A', 'PB_CO2016N30A', 'PB_HRT011N0501OA', 'PB_CO2115N84A', 'PB_IS0034N01A', 'PB_IS2041N30A', 'PB_CO2115N83A', 'PB_PO2031N30A', 'PB_CO1099N68A', 'PB_CO1050N06A', 'PB_CO1099N233A', 'PB_CO1099N232A', 'PB_MM2086N01A', 'PB_HR2177N10A', 'PB_HRT011N0501RA', 'PB_CO1099N07A', 'PB_CO1099N227A', 'PB_CO1099N221A', 'PB_FI0262N25A', 'PB_CO1099N235A', 'PB_FIA001N17A', 'PB_SD0580N45A', 'SUB_GU_TRT007N15A', 'SUB_RO_TRT007N15A', 'SUB_PN_TRT007N15A', 'PB_CO1099N191A', 'PB_CO1099N236A', 'PB_HRT011N0501TA', 'PB_CO1099N231A', 'PB_CO1099N334A', 'PB_MM2112N05A', 'PB_CO1099N399A', 'PB_CO1099N229A', 'PB_CO1062N40A', 'PB_BC0002N31A', 'PB_CO1099N230A', 'PB_FI2073N10A', 'PB_CO2016N10A', 'PB_MDM0009N10A', 'PB_CO1051N01A', 'PB_FI0517N10A', 'PB_FI1049N529A', 'PB_CO1099N367A', 'PB_CO1099N166A', 'PB_HR2177N15A', 'PB_CO1099N228A', 'PB_MM2108N10A', 'PB_HRT011N0501FA', 'PB_CO1049N201A', 'PB_CO1051N11A', 'PB_HRT011N0501GA', 'PB_FI1049N531A', 'PB_FI0044N28A', 'PB_CO1099N347A', 'PB_MM2327N05A', 'PB_HR2177N20A', 'PB_CO1099N206A', 'PB_MMT001N25A', 'PB_FI0044N24A', 'PB_HR2165N03A', 'PB_TRT002N46A', 'PB_MMT001N40A', 'PB_MMT001N35A', 'PB_FIT201N34A', 'PB_CO1099N213A', 'PB_MM2012N05A', 'PB_IS0261N05A', 'PB_MMT001N20A', 'PB_CO1099N430A', 'PB_MMT001N15A', 'PB_MMT001N30A', 'PB_CO1049N152A', 'PB_MM2086N208A', 'PB_HRT004N16M0A', 'PB_FI2256N10A', 'PB_HR2163N03A', 'PB_CO1099N185A', 'PB_IS1019N05A', 'PB_CO1049N192A', 'PB_FI2167N05A', 'PB_CO1099N08A', 'PB_HRT011N0501HA', 'PB_CO1099N113A', 'PB_26-0379N19A', 'PB_MM0060N05A', 'PB_FI1049N151A', 'PB_CO1049N133A', 'PB_FI0262N18A', 'PB_CO1099N370A', 'PB_CO1099N243A', 'PB_HR2175N05A', 'PB_MM2086N407A', 'PB_CO1099N09A', 'PB_PMT001N05A', 'PB_MM2108N25A', 'PB_CO2113N10A', 'PB_CO1062N06A', 'PB_FI0262N133A', 'PB_IS2096N20A', 'PB_FI0262N35A', 'PB_FI1135N05A', 'PB_FI0044N21A', 'PB_PS1000N07A', 'PB_FIT105N25A', 'PB_CO1049N134A', 'PB_IS0261N10A', 'PB_CO1099N10A', 'PB_MM2036N05A', 'PB_CO1099N03A', 'PB_IS2041N10A', 'SUB_PN_TRT006N03A', 'PB_FI5051N20A', 'PB_FI0523N35A', 'PB_CO1062N04A', 'PB_CO1099N329A', 'PB_CO2115N81A', 'PB_MM2086N207A', 'PB_CO1099N405A', 'PB_IS2041N05A', 'PB_CO1099N220A', 'PB_RE0005N10A', 'PB_CO1099N75A', 'PB_CO2113N05A', 'PB_MM2313N05A', 'PB_CO2016N15A', 'PB_FI2071N135A', 'PB_BC0002N30A', 'PB_HR0085N1601HA', 'PB_BC0002N80A', 'PB_IS2044N10A', 'PB_AI0001N108A', 'PB_CO1099N244A', 'PB_HR2175N15A', 'PB_FI1049N72A', 'PB_CO1099N327A', 'PB_FI2200N40A', 'PB_HRT011N55M0A', 'PB_HR0085N1601FA', 'PB_CO1099N136A', 'PB_FI2139N16A', 'PB_CO1099N110A', 'PB_CO2016N20A', 'PB_HR2370N05A', 'PB_FI0370N20A', 'PB_TV2014N45A', 'PB_FI2200N65A', 'PB_CO1099N406A', 'PB_FI0370N05A', 'PB_CO1099N378A', 'PB_FI2139N26A', 'PB_FI2139N27A', 'PB_FI2139N28A', 'PB_CO2113N13A', 'PB_FI2139N15A', 'SUB_JV_TRT003N30A', 'PB_BC0002N20A', 'PB_FI0044N13A', 'PB_FI1049N199A', 'PB_FI0544N05A', 'PB_MDM0009N40A', 'PB_CO1099N245A', 'PB_IS2041N25A', 'PB_GRC0013N05A', 'SUB_BI_FI0523N35A', 'PB_TRT002N43A', 'PB_AI0001N156A', 'PB_CO1099N396A', 'PB_AI0001N126A', 'PB_FI0044N65A', 'SUB_RE_FI0523N35A', 'PB_TRT003N90A', 'SUB_RE_TV0182N10A', 'PB_HR0085N1601OA', 'PB_CO1050N03A', 'PB_FI2139N09A', 'PB_FI2138N03A', 'PB_CO0223N05A', 'PB_CO1099N348A', 'PB_MDM0009N35A', 'PB_CO1099N254A', 'PB_CO1051N08A', 'PB_FI2139N29A', 'PB_TRT002N58A', 'PB_FI2139N30A', 'PB_FI2139N31A', 'PB_BC0002N09A', 'PB_CO1062N47A', 'PB_FI1049N592A', 'PB_HR0126N15A', 'PB_CO1099N253A', 'PB_CO1099N212A', 'PB_AI0001N110A', 'PB_CO1099N247A', 'PB_FI2139N11A', 'PB_CO1062N18A', 'PB_IS2041N20A', 'PB_CO1099N255A', 'PB_CO1099N341A', 'PB_CO1099N252A', 'PB_AI0001N131A', 'PB_FI1049N461A', 'PB_TRT002N59A', 'PB_CO1099N246A', 'PB_HR0085N1601GA', 'PB_CO1099N248A', 'PB_FI0044N05A', 'PB_CO1099N256A', 'PB_CO1099N249A', 'PB_CO1099N251A', 'PB_MM2086N811A', 'PB_AI0001N81A', 'PB_TRT002N37A', 'PB_CO1099N18A', 'PB_HR0085N1601BA', 'PB_CO1099N17A', 'PB_CO1099N250A', 'PB_FI2068N235A', 'PB_CO1099N335A', 'PB_CO1099N16A', 'PB_IS2096N15A', 'PB_MM2323N25A', 'PB_HR2247N30A', 'PB_CO1099N19A', 'PB_SD0602N40A', 'PB_CO1049N52A', 'PB_HRT011N10M0A', 'PB_FI1049N478A', 'PB_CO1099N58A', 'PB_CO2016N55A', 'PB_FI1049N07A', 'PB_PO0003N05A', 'PB_MM2288N25A', 'PB_HRT011N05M0A', 'PB_TRT002N49A', 'PB_TRT002N40A', 'PB_FI2068N215A', 'PB_CO1099N15A', 'PB_HR0085N1601SA', 'PB_HR2238N05A', 'PB_HRT007N15M0A', 'PB_HR0085N1601MA', 'PB_FI2200N30A', 'PB_HR0085N1601AA', 'PB_HR0085N1601TA', 'PB_FI2068N225A', 'PB_FI5045N05A', 'PB_CO1099N602A', 'PB_FI2200N25A', 'PB_FI0262N40A', 'PB_MM2111N05A', 'PB_FI2095N05A', 'PB_HR0085N1601QA', 'PB_CO1099N371A', 'PB_CO1049N76A', 'PB_CO2115N90A', 'PB_FI1049N465A', 'PB_MM2108N85A', 'PB_FIA008N10A', 'PB_CO1049N206A', 'PB_CO1099N340A', 'PB_CO1049N57A', 'PB_AI0001N90A', 'PB_FI1049N477A', 'PB_FI0044N27A', 'PB_MM2234N05A', 'PB_CO1099N263A', 'PB_CO1099N204A', 'PB_CO1099N14A', 'PB_HR2329N05A', 'PB_HR0085N1601PA', 'PB_HR0085N1601RA', 'PB_CO1099N74A', 'PB_TRT002N50A', 'PB_IS2096N10A', 'PB_FI2068N305A', 'PB_HR2336N10A', 'PB_TRT002N55A', 'PB_HR0085N1601NA', 'SUB_RE_FI0190N05A', 'PB_FI2068N175A', 'PB_CO1099N412A', 'PB_FI2068N315A', 'PB_FI2068N195A', 'PB_FIT201N30A', 'PB_HR2247N32A', 'PB_FI2068N165A', 'PB_FI2071N155A', 'PB_FI1049N117A', 'PB_FI2200N55A', 'PB_CO2086N15A', 'PB_FI1049N133A', 'PB_IS2096N06A', 'PB_FI2068N95A', 'PB_FI1049N535A', 'PB_FI1049N533A', 'PB_CO1099N397A', 'PB_IST001N10A', 'PB_HR0085N1601CA', 'PB_FI2068N155A', 'PB_PST001N40A', 'PB_FI2068N65A', 'PB_FI1049N119A', 'PB_FI1049N115A', 'PB_FI2200N35A', 'PB_CO1099N114A', 'PB_AI0001N52A', 'PB_HR0085N1601KA', 'PB_CO1049N73A', 'PB_HR0085N1601EA', 'PB_PST001N18A', 'PB_CO1099N288A', 'PB_HR0085N1601LA', 'PB_HR0085N1601JA', 'PB_FI2068N325A', 'PB_FI2068N75A', 'PB_AI0001N134A', 'PB_HR0085N1601IA', 'PB_FI1049N144A', 'PB_IS2096N05A', 'PB_CO1049N44A', 'SUB_BI_TV0182N10A', 'PB_FI2068N85A', 'PB_FIA001N15A', 'PB_HRT004N60A', 'PB_FI0044N38A', 'PB_HR0015N0501AA', 'PB_FI1049N168A', 'PB_MM2108N50A', 'PB_CO1062N14A', 'PB_TRT005N85A', 'PB_FI0044N26A', 'PB_FI1049N475A', 'PB_FI1049N507A', 'PB_CO1099N165A', 'PB_FI1049N505A', 'PB_AI0001N83A', 'PB_TV0182N05A', 'PB_FI0262N19A', 'PB_PS2041N05A', 'PB_FI1049N328A', 'PB_FI2071N140A', 'SUB_RO_TRT006N03A', 'PB_FI1049N209A', 'PB_FI2071N145A', 'PB_HR0206N99A', 'PB_MM0060N07A', 'PB_FIA002N20A', 'PB_FI2071N160A', 'PB_CO1099N600A', 'PB_FI2071N185A', 'PB_IS1019N20A', 'PB_FI2071N195A', 'PB_FI2071N165A', 'PB_FI2071N150A', 'PB_FI0044N19A', 'PB_FI2071N180A', 'PB_CO1099N400A', 'PB_MDM0009N30A', 'PB_AI0001N112A', 'PB_FI2071N175A', 'PB_PM2131N10A', 'PB_CO1051N20A', 'PB_FI2146N27A', 'PB_FI2232N20A', 'PB_HR0088N26A', 'PB_AI0001N04A', 'PB_MM2086N225A', 'PB_CO2016N60A', 'PB_FI2079N05A', 'PB_FI2233N220A', 'PB_CO1062N48A', 'PB_MM2086N291A', 'PB_MM2086N120A', 'PB_CO2016N45A', 'PB_MM2086N222A', 'PB_HR1068N10A', 'PB_CO2016N35A', 'PB_SD1009N20A', 'PB_PST001N10A', 'PB_TV1200N15A', 'PB_FI1049N02A', 'PB_FI5040N05A', 'PB_FI2071N130A', 'PB_MDM0008N05A', 'PB_FI1156N20A', 'PB_MM2169N05A', 'PB_AI0001N100A', 'PB_FI0579N05A', 'PB_FI0465N05A', 'PB_MM2086N282A', 'PB_MM2086N309A', 'PB_MM2086N261A', 'PB_MM2086N237A', 'PB_MM2086N288A', 'PB_CO2016N50A', 'PB_MM2086N213A', 'PB_MM2086N300A', 'PB_CO2016N40A', 'PB_MM2086N303A', 'PB_CO1062N32A', 'PB_MM2086N246A', 'PB_MM2086N306A', 'PB_HR0106N10A', 'PB_CO1062N28A', 'PB_CO1062N46A', 'PB_FI2259N12A', 'PB_SD0612N15A', 'PB_FI0262N107A', 'SUB_BI_TRT004N22A', 'PB_MM2288N15A', 'PB_AI0001N140A', 'PB_FI1009N10A', 'PB_CO1062N30A', 'PB_FI2071N100A', 'PB_BC0002N07A', 'PB_SD0580N05A', 'PB_MM2027N05A', 'PB_FI0262N136A', 'PB_HRT007N05M0A', 'PB_FI5051N05A', 'PB_MM2266N05A', 'SUB_RE_FI2146N05A', 'PB_FI1049N148A', 'SUB_RN_FI2146N05A', 'PB_BC0010N05A', 'PB_QMT005N05A', 'PB_FI0044N18A', 'PB_PST001N52A', 'PB_PM2131N05A', 'PB_CO1099N601A', 'PB_HRT009N05A', 'SUB_TP_TRT006N03A', 'PB_BC0012N05A', 'PB_FI2081N05A', 'SUB_BI_TRT005N45A', 'PB_AI0001N77A', 'PB_FI0044N37A', 'PB_HR0006N10A', 'PB_CO1062N41A', 'SUB_BI_FI2146N05A', 'PB_FI1156N05A', 'PB_AI0001N141A', 'PB_CO2115N88A', 'PB_MM2081N10A', 'PB_CO1049N250A', 'PB_HRT011N7503A', 'SUB_AN_FI2175N05A', 'PB_TV0170N15A', 'PB_HR0056N10A', 'SUB_BI_TV0182N05A', 'SUB_RE_FI1009N05A', 'PB_PST001N12A', 'PB_PM0010N05A', 'PB_FI2262N35A', 'SUB_RE_FI2000N10A', 'PB_FI0262N130A', 'PB_SD2134N05A', 'PB_SD1079N05A', 'SUB_BI_FI2175N05A', 'PB_MM2086N06A', 'PB_TV1200N20A', 'PB_PST001N02A', 'PB_HR2311N14A', 'PB_SD2094N05A', 'PB_FI0044N25A', 'PB_AM2046N05A', 'PB_IS0020N05A', 'PB_FI2000N21A', 'PB_MM2086N14A', 'SUB_RE_FI1149N05A', 'PB_HR0010N05A', 'PB_FI2301N05A', 'PB_TV2019N05A', 'PB_FI2233N200A', 'PB_PST001N14A', 'PB_MM1003N05A', 'SUB_TA_FI2000N10A', 'PB_FI2297N10A', 'SUB_BI_FI2000N10A', 'PB_PO0014N10A', 'PB_MM2108N40A', 'PB_HR0113N35A', 'PB_AI0001N132A', 'PB_MM0217N05A', 'SUB_AN_TRT005N45A', 'PB_TRT002N56A', 'PB_FI2331N05A', 'PB_FI2262N10A', 'PB_FI2232N15A', 'PB_FI0559N05A', 'PB_FI2301N07A', 'PB_MM2315N05A', 'PB_MM2232N10A', 'PB_FI2233N180A', 'PB_TV0170N05A', 'PB_PST001N26A', 'PB_SD0602N05A', 'SUB_AN_FI0579N05A', 'PB_FI0580N30A', 'PB_MM2086N214A', 'PB_FI0580N25A', 'PB_FI0580N20A', 'PB_TV2014N15A', 'PB_MDM0009N15A', 'PB_PST001N48A', 'PB_MM2081N20A', 'SUB_RE_FI2175N05A', 'PB_FI2039N10A', 'PB_CO1084N40A', 'SUB_AN_TRT004N22A', 'PB_IS2092N05A', 'PB_MM2034N05A', 'PB_SD0580N50A', 'PB_FI0044N60A', 'PB_HRT010N101A', 'PB_CO1061N05A', 'PB_MM0014N10A', 'PB_TRT006N15A', 'PB_HR0630N05A', 'PB_MM2086N106A', 'SUB_BI_SD1079N05A', 'PB_FI1086N15A', 'PB_HR2317N15A', 'PB_MM2086N103A', 'PB_FI2183N10A', 'PB_FI0070N05A', 'PB_HRT007N11M0A', 'PB_MMT003N05A', 'SUB_PN_TRT006N15A', 'PB_HR2193N05A', 'PB_FI2138N04A', 'SUB_GU_TRT006N03A', 'PB_PO0014N15A', 'PB_FI0044N03A', 'PB_PS0072N05A', 'PB_PST001N22A', 'SUB_GP_TRT005N45A', 'PB_MM2108N55A', 'PB_FI0559N15A', 'PB_FI2262N50A', 'SUB_DW_TRT005N45A', 'PB_HR0088N23A', 'SUB_RE_SD1079N05A', 'PB_CO1084N35A', 'PB_HR0630N10A', 'PB_IS2196N05A', 'PB_MM2048N02A', 'PB_FI2232N25A', 'PB_IS2059N10A', 'PB_FI2332N10A', 'PB_HR2379N05A', 'PB_IS0050N05A', 'PB_PP0005N35A', 'PB_TV1200N25A', 'PB_PM2131N20A', 'PB_FI2343N05A', 'PB_TRT002N41A', 'PB_FI2290N05A', 'PB_TV2014N25A', 'PB_AI0001N138A', 'PB_CO0222N05A', 'PB_FI2297N75A', 'PB_FI0044N62A', 'PB_TRT005N30A', 'SUB_BI_FI2332N20A', 'PB_MM2086N262A', 'PB_FI0577N15A', 'SUB_TA_TRT005N45A', 'PB_IS0178N05A', 'PB_FI2301N60A', 'PB_MM2317N05A', 'PB_FI2301N41A', 'PB_TV2014N10A', 'PB_BC0007N10A', 'SUB_PG_TRT006N15A', 'PB_PS2032N05A', 'PB_FI2146N24A', 'PB_MM0014N05A', 'PB_QMT006N16A', 'PB_HR0630N20A', 'PB_FI0262N30A', 'PB_HR0630N15A', 'PB_FI0517N05A', 'PB_FI1079N05A', 'SUB_AN_FI2232N10A', 'PB_QMT006N07A', 'PB_MM1099N65A', 'PB_HR2311N18A', 'SUB_RE_FI2232N10A', 'PB_TRT005N42A', 'PB_IS0164N05A', 'SUB_AN_FI0544N05A', 'PB_IS2215N05A', 'PB_CO1084N25A', 'SUB_RE_FI2332N05A', 'PB_PP0005N130A', 'PB_FI2301N13A', 'PB_TRT005N44A', 'PB_FI2200N05A', 'PB_PST001N24A', 'PB_TV2020N10A', 'PB_MM0125N05A', 'PB_FI2301N17A', 'PB_TV2020N05A', 'PB_FI0044N35A', 'SUB_PG_TRT006N03A', 'PB_HRT010N100A', 'PB_FIA007N10A', 'SUB_AN_FI2152N05A', 'PB_TRT005N40A', 'PB_FI2262N20A', 'PB_FI2261N05A', 'PB_FI2301N23A', 'PB_TRT005N17A', 'SUB_BI_FI2232N05A', 'PB_FI2200N01A', 'PB_FI2301N31A', 'PB_FI2301N27A', 'SUB_BI_FI2232N25A', 'PB_TV2025N05A', 'SUB_NN_TRT005N45A', 'PB_PST001N06A', 'PB_FI0262N05A', 'PB_FI0044N61A', 'PB_QMT006N20A', 'PB_IS2197N05A', 'PB_HR2311N26A', 'PB_BC0002N90A', 'SUB_BI_FI2332N05A', 'PB_FI2233N160A', 'PB_TRT007N15A', 'PB_CO2110N05A', 'PB_SD2104N05A', 'PB_TRT003N30A', 'PB_FI2301N63A', 'PB_HRT010N81A', 'PB_FI2081N09A', 'PB_AI0001N01A', 'PB_MM0003N35A', 'PB_FI2297N70A', 'SUB_GU_TRT006N15A', 'PB_FI2297N15A', 'SUB_NS_TRT005N45A', 'PB_FI2261N10A', 'PB_MDM0013N05A', 'PB_QMT004N05A', 'PB_FI0541N05A', 'SUB_RO_TRT006N15A', 'SUB_RE_FI0370N05A', 'PB_PO2031N15A', 'PB_PP0005N105A', 'SUB_RE_FI2332N20A', 'PB_HR0088N20A', 'PB_CCM0001N20A', 'PB_MM2108N15A', 'PB_FIA007N05A', 'PB_CO2113N70A', 'PB_MM0244N05A', 'PB_QMT006N17A', 'SUB_TA_FI2175N05A', 'PB_FI1052N05A', 'PB_HRT010N92A', 'PB_MM0003N07A', 'PB_TRT002N57A', 'PB_MM2086N101A', 'PB_TRT002N39A', 'PB_FI2332N20A', 'SUB_BT_FI2000N10A', 'PB_TV0170N20A', 'PB_MMT003N30A', 'SUB_TB_TRT005N45A', 'SUB_AN_SD1009N20A', 'SUB_TP_TRT006N15A', 'PB_FI0262N10A', 'SUB_BJ_FI2000N10A', 'PB_CO1084N30A', 'SUB_TE_TRT005N45A', 'PB_CO2113N55A', 'PB_PST001N04A', 'PB_AO2033N05A', 'PB_CO1062N42A', 'SUB_TM_TRT005N45A', 'PB_FI0559N10A', 'PB_MM2086N122A', 'PB_QM2009N13A', 'PB_AI0001N135A', 'SUB_BI_HR0114N05A', 'PB_MM2146N05A', 'PB_PST001N30A', 'SUB_RE_TRT005N45A', 'SUB_PN_TRT007N20A', 'PB_FI2233N100A', 'PB_FI0444N05A', 'PB_FI2233N90A', 'SUB_BI_FI0523N20A', 'SUB_IA_TRT006N03A', 'PB_FI2081N19A', 'PB_AI0001N07A', 'SUB_BN_TRT005N45A', 'SUB_AD_TRT006N03A', 'PB_HRT010N82A', 'PB_TRT007N40A', 'PB_MM0005N05A', 'PB_QMT003N05A', 'PB_TRT004N15A', 'PB_FI1018N05A', 'SUB_BT_TRT005N45A', 'SUB_BJ_TRT005N45A', 'PB_MM2108N45A', 'PB_AI0001N10A', 'PB_SD0591N05A', 'PB_MM2108N30A', 'PB_PO2031N20A', 'PB_CO1084N55A', 'PB_MM2108N35A', 'SUB_RE_FIT105N05A', 'PB_AI0001N13A', 'PB_MM2086N109A', 'PB_PST001N16A', 'PB_FI2200N07A', 'SUB_BJ_FI2175N05A', 'PB_IS0017N05A', 'PB_TRT005N15A', 'PB_MM0001N05A', 'PB_IS2182N05A', 'PB_FI0523N20A', 'PB_PST001N34A', 'PB_FI2081N21A', 'SUB_BT_FI2175N05A', 'PB_CO2113N65A', 'PB_TRT003N126A', 'PB_FI0523N25A', 'PB_PS2029N10A', 'PB_AO1245N05A', 'PB_AI0001N69A', 'PB_HR0088N10A', 'PB_PP0005N10A', 'PB_FI2079N65A', 'PB_TRT005N73A', 'PB_FI1135N110A', 'PB_MDM0009N25A', 'PB_PST001N32A', 'SUB_AN_FI2000N10A', 'PB_MM0002N05A', 'PB_MM0268N05A', 'PB_AI0001N26A', 'PB_MM1099N45A', 'PB_MDM0012N05A', 'PB_PS0002N05A', 'PB_MMT003N10A', 'PB_PST001N07A', 'PB_PST001N08A', 'PB_FI0262N210A', 'PB_FI0044N06A', 'PB_MM0003N02A', 'PB_BC0006N05A', 'PB_FI1135N70A', 'PB_HR2311N22A', 'PB_AI0001N94A', 'PB_PST001N36A', 'PB_MM0003N05A', 'PB_FI2200N60A', 'PB_FI2262N45A', 'PB_FI0044N10A', 'PB_HR0088N24A', 'SUB_AN_SD0591N05A', 'SUB_BI_FI2152N05A', 'SUB_AN_FI0523N20A', 'PB_MM9999N05A', 'PB_MM9999N10A', 'PB_MM9999N15A', 'PB_PP0005N135A', 'PB_PP0005N40A', 'PB_MM2064N07A', 'SUB_BI_TRT004N20A', 'PB_TRT003N125A', 'PB_MM2321N15A', 'PB_MM0003N40A', 'PB_MM0003N43A', 'PB_PP0005N115A', 'SUB_BI_TRT004N15A', 'PB_FI0262N169A', 'PB_FI2297N20A', 'SUB_AN_TRT005N40A', 'PB_TRT002N12A', 'PB_MMT003N15A', 'PB_MDM0007N05A', 'PB_TRT007N20A', 'PB_TRT003N25A', 'PB_FI2092N10A', 'PB_FI2200N08A', 'PB_TV2014N35A', 'SUB_JV_TRT003N25A', 'PB_PP0005N120A', 'PB_FI0262N215A', 'PB_IS2195N05A', 'SUB_BI_TRT003N25A', 'PB_FI2200N03A', 'PB_PP0005N175A', 'PB_TRT004N20A', 'SUB_AN_SD0580N05A', 'PB_PP0005N20A', 'PB_FI2200N10A', 'SUB_RO_TRT007N20A', 'PB_BC0008N05A', 'PB_MM0005N20A', 'PB_QMT006N18A', 'SUB_RE_TRT003N30A', 'PB_IS0178N15A', 'PB_TRT004N10A', 'PB_MM0003N15A', 'SUB_AN_TRT003N30A', 'PB_FI0262N185A', 'PB_PP0005N30A', 'PB_MM0005N10A', 'PB_FI2332N15A', 'PB_MDM0001N15A', 'PB_QMT006N14A', 'SUB_BI_FI2332N10A', 'PB_MM0005N25A', 'PB_TV2014N20A', 'PB_TV2014N40A', 'PB_BC0014N05A', 'PB_TV2014N05A', 'PB_TV2014N30A', 'PB_QMT006N04A', 'PB_PP0005N25A', 'PB_PP0005N145A', 'PB_TRT001N17A', 'SUB_PG_TRT007N10A', 'PB_QMT006N03A', 'PB_FI0262N175A', 'PB_CRM2009N15A', 'SUB_TP_TRT007N20A', 'SUB_RE_FI2332N10A', 'SUB_AD_TRT007N10A', 'PB_FI0262N157A', 'PB_FI0262N172A', 'PB_BC0007N05A', 'SUB_TA_FI2332N10A', 'PB_FI0262N01A', 'PB_MMT003N20A', 'PB_PP0005N180A', 'PB_MDM0004N05A', 'PB_PP0005N05A', 'PB_SD2145N05A', 'SUB_BI_TRT003N15A', 'PB_TRT003N15A', 'PB_PP0005N140A', 'PB_MM9999N50A', 'PB_MM0003N25A', 'SUB_AN_TRT003N15A', 'PB_QMT006N05A', 'PB_IS0164N10A', 'PB_PP0005N165A', 'SUB_IA_TRT007N10A', 'PB_PP0005N170A', 'SUB_AN_TRT003N25A', 'PB_MDM0009N05A', 'PB_MM9999N20A', 'PB_FI0262N160A', 'PB_TRT003N115A', 'PB_MM9999N40A', 'SUB_TP_TRT007N10A', 'SUB_JV_TRT003N15A', 'PB_PP0005N160A', 'PB_PP0005N155A', 'PB_MM0003N30A', 'PB_TRT002N10A', 'SUB_PG_TRT003N60A', 'PB_MM9999N35A', 'PB_SD2146N05A', 'PB_MM9999N45A', 'SUB_AD_TRT007N20A', 'PB_MM9999N60A', 'PB_MM9999N55A', 'SUB_JV_TRT001N17A', 'PB_SD2130N05A', 'PB_MM0005N15A', 'PB_MM9999N65A', 'PB_MM9999N30A', 'PB_HR2377N05A', 'PB_MM9999N25A', 'PB_PP0005N150A', 'SUB_BI_TV1202N05A', 'PB_PP0005N185A', 'PB_PP0005N15A', 'PB_TRT001N15A', 'PB_TV1202N05A', 'PB_MM0003N20A', 'PB_MDM0001N10A', 'PB_MMT003N25A', 'PB_MM0003N10A', 'SUB_JV_TRT001N15A', 'PB_MDM0001N12A', 'PB_MM0003N33A', 'PB_IS2108N05A', 'PB_IS0178N10A', 'PB_MMT003N35A', 'PB_CRM2009N05A', 'SUB_PN_TRT002N20A', 'PB_BC0002N02A', 'PB_PS1025N25A', 'PB_MM0003N27A', 'SUB_PT_TRT002N20A', 'SUB_GF_TRT002N20A', 'SUB_IA_TRT002N20A', 'PB_HR2311N38A', 'SUB_CI_TRT002N14A', 'SUB_TP_TRT002N20A', 'SUB_RO_TRT002N20A', 'PB_BC0002N03A', 'SUB_PG_TRT002N20A', 'PB_MM0003N37A', 'PB_MM2045N05A', 'SUB_GU_TRT002N20A', 'SUB_BI_TRT002N10A', 'SUB_IR_TRT002N20A', 'SUB_PS_TRT002N20A', 'SUB_TM_TRT002N14A', 'SUB_AD_TRT002N20A', 'SUB_BN_TRT002N10A', 'SUB_TE_TRT002N14A', 'SUB_BT_TRT002N10A', 'SUB_BJ_TRT002N10A', 'SUB_AN_TRT002N10A', 'SUB_LI_TRT002N20A', 'SUB_RE_TRT002N10A', 'SUB_LG_TRT002N10A', 'SUB_PE_TRT002N10A', 'SUB_IT_TRT002N20A', 'SUB_DS_TRT002N20A', 'SUB_NE_TRT002N10A', 'SUB_PV_TRT002N20A', 'SUB_PM_TRT002N20A', 'SUB_CI_TRT002N10A', 'SUB_TA_TRT002N10A', 'SUB_BO_TRT002N20A', 'SUB_CD_TRT002N10A', 'SUB_PD_TRT002N10A', 'SUB_TB_TRT002N10A', 'SUB_TM_TRT002N10A', 'SUB_BI_TRT002N12A', 'SUB_TE_TRT002N10A', 'PB_TRT002N14A', 'SUB_TM_TRT002N12A', 'SUB_RE_TRT002N12A', 'PB_TRT004N00A', 'SUB_CD_TRT002N12A', 'SUB_TA_TRT002N12A', 'SUB_CD_TRT002N14A', 'SUB_AN_TRT002N12A', 'SUB_TE_TRT002N12A', 'SUB_BJ_TRT002N12A', 'SUB_PE_TRT002N12A', 'SUB_BT_TRT002N14A', 'SUB_BT_TRT002N12A', 'SUB_LG_TRT002N12A', 'SUB_NE_TRT002N12A', 'SUB_BJ_TRT002N14A', 'SUB_PE_TRT002N14A', 'SUB_RE_TRT002N14A', 'SUB_BN_TRT002N12A', 'SUB_BN_TRT002N14A', 'SUB_NE_TRT002N14A', 'SUB_PD_TRT002N12A', 'SUB_TB_TRT002N12A', 'SUB_CI_TRT002N12A', 'SUB_PD_TRT002N14A', 'SUB_BI_TRT002N14A', 'SUB_TB_TRT002N14A', 'SUB_TA_TRT002N14A'  ]

def main():
    for job in JOBS:
        print(job)
        try:
            run(job)
        except ValueError:
            print('error ->', job)
def run(job):
    start_date = '2019-01-01'
    end_date = '2020-01-01'
    cutoff_duration = MIN_JOB_DURATION
    execs = fetch_executions(job, start_date, end_date, cutoff_duration)
    winsize = max(int(len(execs) * WINDOW_SIZE_FACTOR), WINDOW_SIZE_MIN)
    scored_execs = score(execs, winsize)
    #elbow = find_elbow(scored_execs, winsize)
    #fill_threshold(scored_execs, elbow, knee)
    #scored_execs.dropna(inplace=True)
    #scored_execs = scored_execs[ [ 'start', 'duration', 'upper_threshold', 'ref_duration', 'score' ] ]
    #scored_execs.to_csv('teste.tsv', sep='\t', decimal=',')
    save_graph(job, scored_execs)
    #save_scatter(job, scored_execs)

def fetch_executions(job, start_date, end_date, cutoff_duration):
    sql = FETCH_SQL_LIKE if '%' in job else FETCH_SQL
    conn = util.get_db_conn('BOLZANO')
    cursor = conn.cursor()
    args = job, start_date, end_date, cutoff_duration
    cursor.execute(sql, args)
    starts = []
    durations = []
    for row in cursor:
        starts.append(row[0])
        durations.append(row[1])
    df = pd.DataFrame({ 'start': starts, 'duration': durations })
    return df

def score(execs, winsize):

    def detrend(series):
        diff = series - series.mean()
        return diff.sub(diff.min() - 1)

    def remove_percentile(series, pct):
        p_head, p_tail = series.quantile(pct), series.quantile(1.0 - pct)
        return series[ series.between(p_head, p_tail, inclusive=False) ]

    def remove_outliers(series):
        return series[ abs(series - series.median()) / series.mad() < 2 ]

    def boxcoxify(series, duration):
        bc_series, lambda_ = stats.boxcox(series)
        bc_series = pd.Series(bc_series)
        bc_duration = special.boxcox([ duration ], lambda_)[ 0 ]
        return pd.Series(bc_series), bc_duration

    def score_window(window):
        window = pd.Series(window)
        detrended_window = detrend(window).to_numpy()
        #print(detrended_window)
        window, duration = pd.Series(detrended_window[ : -1 ]), detrended_window[ -1 ]
        #window = remove_10_percent(window)
        window = remove_outliers(window)
        bc_window, bc_duration = boxcoxify(window, duration)
        bc_mean = bc_window.mean()
        bc_stdev = bc_window.std(ddof=1) # bc_window.std(ddof=1)
        zscore = (bc_duration - bc_mean) / bc_stdev
        return zscore

    durations = execs[ 'duration' ]
    log_durations = durations.apply(math.log1p)
    zscores = durations.rolling(winsize).apply(score_window, raw=True)
    execs[ 'score' ] = zscores
    return execs

def find_elbow(scored_execs, winsize):
    scored_execs = scored_execs.dropna()
    ys = scored_execs[ 'score' ].to_numpy()
    ys.sort()
    xs = np.linspace(ys.min(), ys.max(), len(ys))
    data = np.vstack( (xs, ys) ).T
    r = kbr.Rotor()
    r.fit_rotate(data)
    elbow = ys[ r.get_elbow_index() ]
    new_scored_execs = scored_execs[ scored_execs.score >= elbow ]
    if len(new_scored_execs) >= ELBOW_FINDING_EXIT_QTY and len(new_scored_execs) != len(scored_execs):
        return find_elbow(new_scored_execs, winsize)
    else:
        return elbow


def save_graph(job, scored_execs):
    outliers_3 = scored_execs[ scored_execs[ 'score' ].ge(3.5) ]
    outliers_5 = scored_execs[ scored_execs[ 'score' ].ge(5.5) ]
    outliers_7 = scored_execs[ scored_execs[ 'score' ].ge(7.5) ]
    plt.close('all')
    plt.figure(num=None, figsize=(GRAPH_WIDTH, GRAPH_HEIGHT))
    #plt.yscale('log')
    #plt.plot_date(scored_execs[ 'start' ], scored_execs[ 'duration' ], '+', label='Job Duration')
    #plt.plot_date(scored_execs[ 'start' ], scored_execs[ 'upper_threshold' ], '--r', label='Upper Threshold')
    #plt.plot_date(scored_execs[ 'start' ], scored_execs[ 'lower_threshold' ], '--r', label='Lower Threshold')
    plt.plot_date(scored_execs[ 'start' ], scored_execs[ 'duration' ], label='Duration')
    #plt.plot_date(scored_execs[ 'start' ], scored_execs[ 'threshold' ], '--', label='Threshold')
    #plt.xlabel('Start')
    plt.plot_date(outliers_3[ 'start' ], outliers_3[ 'duration' ], 'oy', label='Outlier')
    plt.plot_date(outliers_5[ 'start' ], outliers_5[ 'duration' ], 'om', label='Outlier')
    plt.plot_date(outliers_7[ 'start' ], outliers_7[ 'duration' ], 'or', label='Outlier')
    #plt.ylabel('lg(Time(s))')
    plt.title(job)
    plt.grid()
    #plt.legend()
    plt.savefig(f'JOB_{job}.png')
    plt.close('all')
    plt.hist(scored_execs[ 'score' ], bins=50)
    plt.savefig(f'SCORES_{job}.png')


